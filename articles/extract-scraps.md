---
title: "特定の条件を満たす（Scrapboxの）スクラップを抽出して別プロジェクトへコピーする"
emoji: "🔖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [scrapbox, rust]
published: false
---

やってみた系の記事です。

Scrapbox[^1]を利用している際に、あるプロジェクトのページのうち一部を別プロジェクトにコピーしたいと思うことがありました。
やってみたら案外簡単にできたので備忘録として記事に残しておこうと思います。

# やりたいこと

- 移行元のプロジェクトAのうち、特定の条件を満たすようなスクラップを別のプロジェクトへコピーする
- ここでの特定の条件とは、以下に示すもののうちどちらかを満たすものとする
  - ページタイトルに特定の文字列を含む（文字列の例：`本`）
  - ページ本文に特定のタグ[^2]を含む（タグの例：`#book`）

つまり、タイトルに「本」を含んでいるか、あるいは#bookというタグを持つスクラップを別のプロジェクトへコピーするということです。

# 方法

Scrapboxにはプロジェクト内のページをインポートおよびエクスポートする機能[^3]があります。エクスポート機能ではプロジェクトのデータをあらわすようなJSONのファイルを取得でき、インポート機能ではJSONのファイルを使ってページを作成することができます。

今回は移行元のプロジェクト内容をエクスポートし、得られたJSONにふるいを掛けることで目的のページデータのみを残したJSONを作成します。作成したファイルを移行先のプロジェクトにインポートすれば、目的であったページのコピーが実現できることになります。

JSONのデータにふるいを掛ける部分についてはRustを利用して実現しました。JSONのシリアライズ・デシリアライズには[serde](https://docs.rs/serde/latest/serde/)と[serde_json](https://docs.rs/serde_json/latest/serde_json/)を使っています。

# 作ったもの

今回書いたスクリプトを載せておきます。

https://github.com/lemonadern/extract-scraps

清々しいほどにエラーハンドリングをしていないコードなので流用する場合は注意してください。

## 解説

大したことはしていませんが簡単に解説をします。

構造体を定義している部分について、これはインポート時に必要なJSONのフォーマットを眺めて決定しました。インポート時に必要なJSONはエクスポートしたJSONからいくつかのフィールドを削ったものと同じなので、In/Outで別のデータ構造を用意する必要がありませんでした。また、エクスポートされたJSONのうち余分なフィールドは、未知のフィールドが無視されるというserdeデフォルトの挙動を利用してデシリアライズ時にデータ自体を削っています。

https://github.com/lemonadern/extract-scraps/blob/master/src/main.rs#L5-L14

次に全体的な処理の流れについてです。こちらは素朴にファイル内容を読み込んでfilterをかけ、結果をシリアライズしてファイルに書き出しているだけです。今回は移行元のページ数は560、抽出されたページ数は25だったためか特に問題は起きませんでした。巨大なJSONを読ませる場合は改善が必要になるかもしれません。

https://github.com/lemonadern/extract-scraps/blob/master/src/main.rs#L16-L44

[^1]: https://scrapbox.io

[^2]: https://scrapbox.io/help-jp/HashTag

[^3]: https://scrapbox.io/help-jp/Import_Pages_%2F_Export_Pages
